name: Find Multi-Route Harish Schedule

# טריגרים: הרצה יומית אוטומטית (בשעה 01:00 UTC) והרצה ידנית
on:
  schedule:
    - cron: '0 1 * * *'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    # הגדרת הרשאות כתיבה כדי לאפשר ל-Action לדחוף קבצים חזרה לריפוזיטורי
    permissions:
      contents: write 

    steps:
      - uses: actions/checkout@v3

      # הגדרת סביבת Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # התקנת הספריות הנדרשות
      - name: Install dependencies
        run: |
          pip install pandas requests

      # שלב: הפעלת סקריפט Python לעיבוד
      - name: Run processing script
        env:
          # רשימת התחנות - נשמר כאן כפרמטר
          TARGET_STOPS: "43898,43899,43897,43334,43496,40662"
        run: python MultiRouteFinder.py

      # שלב: העלאת הקובץ המעובד (JSON) והקבצים המסוננים (TXT) חזרה ל-GitHub
      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # הוספת קובץ הפלט
          git add harish_multi_route_schedule.json
          
          # הוספת התיקייה עם הקבצים המסוננים (אם קיימים)
          # ה-|| true מונע שגיאה אם התיקייה ריקה
          git add extractedGtfs/*.txt || true
          
          # ביצוע Commit ו-Push
          git commit -m "Automated GTFS update and filtering [skip ci]" || true 
          git push
