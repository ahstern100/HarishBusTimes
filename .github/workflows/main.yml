name: Process GTFS Data

on:
  schedule:
    # הרצה יומית ב-1:00 לפנות בוקר UTC (לשנות לפי הצורך)
    - cron: '0 1 * * *'
  workflow_dispatch:
    # מאפשר הפעלה ידנית לצורך בדיקה

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10' # מומלץ להשתמש בגרסה ספציפית

      - name: Install dependencies
        run: |
          # התקנת הספריות הנדרשות על ידי הסקריפט
          pip install pandas requests

      # שלב: הפעלת סקריפט Python לעיבוד
      - name: Run processing script
        run: python processing_script.py
        
      # שלב: העלאת הקובץ המעובד (JSON) חזרה ל-GitHub
      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # בדוק אם הקובץ נוצר
          if [ -f "harish_bus20_schedule.json" ]; then
            git add harish_bus20_schedule.json
            git commit -m "Automated GTFS data update: Harish Bus 20 [skip ci]"
            git push
          else
            echo "Error: harish_bus20_schedule.json not found. Aborting commit."
            exit 1
          fi
